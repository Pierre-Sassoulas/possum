{% extends "base_with_aside.html" %}
{% load i18n %}
{% load staticfiles %}
{% block extrajs %}
<script src="{% static "highcharts/js/highcharts.js" %}"></script>
<script src="{% static "highcharts/js/modules/exporting.js" %}"></script>
{% endblock %}
{% block content %}
<div class="panel panel-default">
<div id="chart_panel" class="panel-body" style="width:100%;height:314px"></div>
</div>

<script type="text/javascript">
$(document).ready(function() {

    // Glucose Average by Day chart
     var avgByDayOptions = {
        chart: {
            renderTo: 'chart_panel',
            type: 'line',
        },
        legend: {enabled: true},
        title: {text: '{{title}}'},
    {% if date_begin and date_end %}
        subtitle: {text: '{{date_begin}} > {{date_end}}'},
    {% endif %}
//        xAxis: {title: {text: null}, labels: {rotation: -45}},
        xAxis: {type: 'datetime', },
        yAxis: {title: {text: null}},
        series: [{}],
        credits: {enabled: false},
    };
    {% if date_begin and date_end %}
    var chartDataUrl = "{% url 'stats_dump' rapport interval date_begin date_end %}";
    $.getJSON(chartDataUrl,
        function(data) {
        avgByDayOptions.series = data['chart_data'];
//        avgByDayOptions.series = [{name: 'Avg Glucose (mg/dL)', 
//                                   data: [
//                            [Date.UTC(2010, 0, 1), 29.9],
//                            [Date.UTC(2010, 2, 1), 71.5],
//                            [Date.UTC(2010, 3, 1), 106.4]]},
//                            {name: "test",
//                            data: [
//                            [Date.UTC(2010, 0, 2), 39.9],
//                                            [Date.UTC(2010, 2, 2), 41.5],
//                                                            [Date.UTC(2010, 3, 3), 106.4]
//                            ]}];
            var chart = new Highcharts.Chart(avgByDayOptions);
    });
    {% endif %}
} );
</script>
{% endblock %}
{% block side %}
<form method='post' action='{% url "stats_charts" %}'>
{% csrf_token %}
<h2>{% trans "Interval" %}</h2>
<label class="radio-inline">
    <input type="radio" name="interval" id="rad1" value="d"
        {% if interval == "d" %}checked{% endif %}>{% trans "day" %}
</label>
<label class="radio-inline">
    <input type="radio" name="interval" id="rad2" value="w"
        {% if interval == "w" %}checked{% endif %}>{% trans "week" %}
</label></br>
<label class="radio-inline">
    <input type="radio" name="interval" id="rad3" value="m"
        {% if interval == "m" %}checked{% endif %}>{% trans "month" %}
</label>
<label class="radio-inline">
    <input type="radio" name="interval" id="rad4" value="y"
        {% if interval == "y" %}checked{% endif %}>{% trans "year" %}
</label>
<button type="submit" class="btn btn-primary pull-right">{% trans "View" %}</button>

<h2>{% trans "Date" %}</h2>
{% trans "From" %}
<div id="datepicker-container">
    <div class="input-group date">
        <input type='text' class="form-control" name="date_begin"
               value="{{date_begin}}"/>
        <span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
    </div>
</div>
{% trans "To" %}
<div id="datepicker-container">
    <div class="input-group date">
        <input type='text' class="form-control" name="date_end"
               value="{{date_end}}"/>
        <span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
    </div>
</div>

<div class="radio-group-vertical form-group">
    {% for key, value in rapports.items %}
    <label class="radio">
        <input type="radio" name="rapport" id="rad_rap_{{key}}" value="{{key}}"
        {% ifequal rapport key %}checked{% endifequal %}>{{value.name}}
    </label>
    {% endfor %}
</div>
</form>

<script type="text/javascript">
    $(document).ready(function () {
        $('#datepicker-container .input-group.date').datepicker({
            format: "dd-mm-yyyy",
            startDate: "{{first_date}}",
            endDate: "{{last_date}}",
            keyboardNavigation: false,
            calendarWeeks: true,
            autoclose: true,
            todayHighlight: true
        });
    });
</script>
{% endblock %}

